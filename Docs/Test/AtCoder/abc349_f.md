---
title: ABC349-F Subsequence LCM
documentation_of: //Test/AtCoder/abc349_f.test.cpp
---

$M$ で割り切れないような要素を部分列に含めると必ず部分列の最小公倍数は $M$ で無くなる。以後 $A$ のすべての要素が $M$ で割り切れることを仮定する。

$M$ を素因数分解して、 $M = \prod p_{i}^{e_{i}}$ という表示を得たとする。 この $(p_{i}, e_{i})$ を順に並べた列を $F$ とする。

$A$ のすべての要素が $M$ で割り切れるとして、 $A$ のある部分列の最小公倍数が $M$ とならない必要十分条件は以下の通りである。

ある $F$ の要素 $(p_{i}, e_{i})$ が存在して、部分列のすべての要素が $p_{i}^{e_{i}}$ で割り切れない。

このことから包除原理を適用して数え上げることができる。 $F$ のすべての部分列 $F'$ について $\prod_{i\in F'} p_{i}^{e_{i}}$ で割り切れないように $A$ から部分列を取る通り数を数えれば良い。

$M\le 10^{16}$ ゆえ、 $\mid F \mid \le 13$ である。 $A$ のすべての要素は $M$ で割り切れるという仮定から $A$ の要素の種類数は $43008$ 以下である。

- [参考: 高度合成数](https://algo-method.com/descriptions/92)
